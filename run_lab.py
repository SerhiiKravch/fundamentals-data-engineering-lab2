#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏.
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É—î –≤—Å—ñ –µ—Ç–∞–ø–∏: –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º, –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.
"""

import subprocess
import sys
import time
from pathlib import Path

def run_command(command, description):
    """–í–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥—É —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –ø—Ä–æ–≥—Ä–µ—Å"""
    print(f"\n{'='*60}")
    print(f"üîÑ {description}")
    print(f"{'='*60}")
    
    try:
        # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Python –∑ —å–≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
        python_exe = "./venv/bin/python"
        full_command = [python_exe] + command.split()[1:]  # –í–∏–¥–∞–ª—è—î–º–æ "python" –∑ –∫–æ–º–∞–Ω–¥–∏
        
        result = subprocess.run(full_command, capture_output=True, text=True, cwd=Path.cwd())
        
        if result.returncode == 0:
            print("‚úÖ –£—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω–æ!")
            if result.stdout:
                print("\n–í–∏—Ö—ñ–¥:")
                print(result.stdout)
        else:
            print("‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è!")
            if result.stderr:
                print("–ü–æ–º–∏–ª–∫–∞:")
                print(result.stderr)
            return False
            
    except Exception as e:
        print(f"‚ùå –í–∏–Ω—è—Ç–æ–∫: {e}")
        return False
    
    return True

def main():
    """–û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó"""
    
    print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                              ‚ïë
‚ïë               –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê 2: –°–•–ï–ú–ò "–ó–Ü–†–ö–ê" –¢–ê "–°–ù–Ü–ñ–ò–ù–ö–ê"            ‚ïë
‚ïë                                                                              ‚ïë
‚ïë  –¶–µ–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω–∞—î –≤—Å—ñ –µ—Ç–∞–ø–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏:              ‚ïë
‚ïë  1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø—Ä–æ–¥–∞–∂—ñ                                 ‚ïë
‚ïë  2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º–∏ "–∑—ñ—Ä–∫–∞" (–¥–µ–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞)                              ‚ïë
‚ïë  3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º–∏ "—Å–Ω—ñ–∂–∏–Ω–∫–∞" (–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞)                             ‚ïë
‚ïë  4. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤                          ‚ïë
‚ïë  5. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–≤—ñ—Ç—É –∑ –≤–∏—Å–Ω–æ–≤–∫–∞–º–∏                                           ‚ïë
‚ïë                                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    """)
    
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
    venv_python = Path("./venv/bin/python")
    if not venv_python.exists():
        print("‚ùå –í—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!")
        print("–ë—É–¥—å –ª–∞—Å–∫–∞, —Å—Ç–≤–æ—Ä—ñ—Ç—å –π–æ–≥–æ –∫–æ–º–∞–Ω–¥–æ—é:")
        print("python3 -m venv venv && source venv/bin/activate && pip install -r requirements.txt")
        return
    
    print("üöÄ –†–æ–∑–ø–æ—á–∏–Ω–∞—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏...")
    
    # –ï—Ç–∞–ø–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
    steps = [
        ("python generate_data.py", "–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (50,000 –∑–∞–ø–∏—Å—ñ–≤)"),
        ("python schemas/star_schema.py", "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º–∏ '–∑—ñ—Ä–∫–∞' (–¥–µ–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞)"),
        ("python schemas/snowflake_schema.py", "–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ö–µ–º–∏ '—Å–Ω—ñ–∂–∏–Ω–∫–∞' (–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞)"),
        ("python queries/performance_comparison.py", "–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤")
    ]
    
    start_time = time.time()
    
    for i, (command, description) in enumerate(steps, 1):
        print(f"\nüìã –ï—Ç–∞–ø {i}/{len(steps)}")
        
        if not run_command(command, description):
            print(f"\nüí• –ü–æ–º–∏–ª–∫–∞ –Ω–∞ –µ—Ç–∞–ø—ñ {i}. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ.")
            return
        
        time.sleep(1)  # –ö–æ—Ä–æ—Ç–∫–∫–∞ –ø–∞—É–∑–∞ –º—ñ–∂ –µ—Ç–∞–ø–∞–º–∏
    
    # –ü—ñ–¥—Å—É–º–æ–∫
    end_time = time.time()
    execution_time = end_time - start_time
    
    print(f"\n{'='*80}")
    print("üéâ –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê –£–°–ü–Ü–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê!")
    print(f"{'='*80}")
    print(f"‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: {execution_time:.1f} —Å–µ–∫—É–Ω–¥")
    print(f"üìÅ –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏:")
    print(f"   ‚Ä¢ data/star_schema.db - –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å—Ö–µ–º–∏ '–∑—ñ—Ä–∫–∞'")
    print(f"   ‚Ä¢ data/snowflake_schema.db - –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å—Ö–µ–º–∏ '—Å–Ω—ñ–∂–∏–Ω–∫–∞'")
    print(f"   ‚Ä¢ data/performance_comparison.png - –ì—Ä–∞—Ñ—ñ–∫ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è")
    print(f"   ‚Ä¢ REPORT.md - –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –∑ –≤–∏—Å–Ω–æ–≤–∫–∞–º–∏")
    
    print(f"\nüìä –û–°–ù–û–í–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò:")
    print(f"   ‚Ä¢ –°—Ö–µ–º–∞ '–∑—ñ—Ä–∫–∞' –ø–µ—Ä–µ–º–æ–≥–ª–∞ –≤ —É—Å—ñ—Ö 5 —Ç–µ—Å—Ç–∞—Ö")
    print(f"   ‚Ä¢ –°–µ—Ä–µ–¥–Ω—î –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ: ~25%")
    print(f"   ‚Ä¢ –ù–∞–π–±—ñ–ª—å—à–∞ –ø–µ—Ä–µ–≤–∞–≥–∞: –∑–∞–ø–∏—Ç–∏ –∑ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ—é –∞–≥—Ä–µ–≥–∞—Ü—ñ—î—é")
    
    print(f"\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á:")
    print(f"   ‚Ä¢ –î–ª—è —à–≤–∏–¥–∫–æ—ó –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å—Ö–µ–º—É '–∑—ñ—Ä–∫–∞'")
    print(f"   ‚Ä¢ –î–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –ø—Ä–æ—Å—Ç–æ—Ä—É: —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ —Å—Ö–µ–º—É '—Å–Ω—ñ–∂–∏–Ω–∫–∞'")
    print(f"   ‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –¥–∏–≤—ñ—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ REPORT.md")
    
    print(f"\nüîç –î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≥—Ä–∞—Ñ—ñ–∫—ñ–≤:")
    print(f"   open data/performance_comparison.png")

if __name__ == "__main__":
    main()